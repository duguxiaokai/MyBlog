<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Add Statistics</title>
<link href='__PUBLIC__/css/common.css' rel='stylesheet' type='text/css'>
<link href='__PUBLIC__/themes/yellow/css/common.css' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="__PUBLIC__/js/My97DatePicker/WdatePicker.js"></script>
<script src="__PUBLIC__/js/jquery.js" type="text/javascript"></script>
<style type="text/css">
	.table tr td{ border:#C66200 1px solid;}
	.timeselect tr td{ border:none;}
</style>
</head>
<body>
<form method="post" action="">
<table class='table' cellspacing="0" cellpadding="10" align="center" style="font-size:12px; border-collapse:collapse; margin-top:10px;">
	<tr>
		<td align="right" style="background:#FFB31F; color:#FFF"><strong>Statistical Categories:</strong></td>
		<td>
			<select id="protype" name="protype" >
				<option value="Monthly Statistics of Revenue" selected="true">Monthly Statistics of Revenue</option>
				<option value="Teacher Statistics">Teacher Statistics</option>
				<option value="Location Statistics">Location Statistics</option>
			</select>
		</td>
	</tr>
	<tr>
		<td style="background:#FFB31F; color:#FFF" align="right" valign="top"><strong>Please Select Time Span For Statistics</strong></td>
		<td><table cellpadding="0" cellspacing="0" border="0" class="timeselect">
				<tr>
					<td><input type="radio" id="dateall" name="datetongji" value="All Time">All</td>
				</tr>
				<tr>
					<td>
					<input type="radio" id="specific" name="datetongji" value="">Year:
					<select id="selectyear" onchange='changeyearmonth()'>  
					   <option value="" id='year0'></option> 
					   <option value="2001" id='year2001'>2001</option> 
					   <option value="2002" id='year2002'>2002</option> 
					   <option value="2003" id='year2003'>2003</option> 
					   <option value="2004" id='year2004'>2004</option> 
					   <option value="2005" id='year2005'>2005</option> 
					   <option value="2006" id='year2006'>2006</option> 
					   <option value="2007" id='year2007'>2007</option> 
					   <option value="2008" id='year2008'>2008</option> 
					   <option value="2009" id='year2009'>2009</option> 
					   <option value="2010" id='year2010'>2010</option> 
					   <option value="2011" id='year2011'>2011</option> 
					   <option value="2012" id='year2012'>2012</option> 
					   <option value="2013" id='year2013'>2013</option> 
					   <option value="2014" id='year2014'>2014</option> 
					   <option value="2015" id='year2015'>2015</option>
					   <option value="2016" id='year2016'>2016</option> 
					   <option value="2017" id='year2017'>2017</option> 
					   <option value="2018" id='year2018'>2018</option> 
					   <option value="2019" id='year2019'>2019</option> 
					   <option value="2020" id='year2020'>2020</option> 
					   <option value="2021" id='year2021'>2021</option> 
					   <option value="2022" id='year2022'>2022</option> 
					   <option value="2023" id='year2023'>2023</option> 
					   <option value="2024" id='year2024'>2024</option> 
					   <option value="2025" id='year2025'>2025</option> 
					   <option value="2026" id='year2026'>2026</option> 
					   <option value="2027" id='year2027'>2027</option> 
					   <option value="2028" id='year2028'>2028</option> 
					   <option value="2029" id='year2029'>2029</option> 
					   <option value="2030" id='year2030'>2030</option> 
					</select>
					Month:
					<select id="selectmonth" onchange='changeyearmonth()' >  
					   <option value="" id='month0'></option> 
					   <option value="01" id='month1'>01</option> 
					   <option value="02" id='month2'>02</option> 
					   <option value="03" id='month3'>03</option> 
					   <option value="04" id='month4'>04</option> 
					   <option value="05" id='month5'>05</option> 
					   <option value="06" id='month6'>06</option> 
					   <option value="07" id='month7'>07</option> 
					   <option value="08" id='month8'>08</option> 
					   <option value="09" id='month9'>09</option> 
					   <option value="10" id='month10'>10</option> 
					   <option value="11" id='month11'>11</option> 
					   <option value="12" id='month12'>12</option> 
					</select>					
					</td>
				</tr>
				<tr>
					<td><input type="radio" id="datespecific" name="datetongji" value="" >Time Span:</td>
				</tr>
				<tr>
					<td>
						<table>
							<tr>
								<td>From:&nbsp<input type="text" id="startdate" name="startdate" onFocus="WdatePicker({skin:'whyGreen',dateFmt:'yyyy-MM-dd'})" style="width:80px;"></td>
								<td>To:&nbsp<input type="text" id="enddate" name="enddate" onFocus="WdatePicker({skin:'whyGreen',dateFmt:'yyyy-MM-dd'})" style="width:80px;" ></td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
	 	</td>
	</tr>
	<tr>
    	<td class='tabletr' colspan="2" align="center">
		<input type="button" value="OK" onClick="tongji()" class="formbutton" onMouseOut="this.className='formbutton';" onMouseOver="this.className='formbutton_hover';">
  </tr>
</table>
</form>
<span id='status'></span>
</body>
</html>

<script type="text/javascript">
    var isdoing=false;
    function tongji() {
        if(isdoing == false){
            addwholetongji();
        }else if(isdoing){
            alert('Please wait while running...');
        }
    }
	function addwholetongji(){
		var urlpath="__APP__/Yoga/Tongji/savenewwholetongji/";
		var protype=$("#protype").val();
		var datewhoel;
		var month="";
		var startdate=$("#startdate").val();
		var enddate=$("#enddate").val();
		if(document.getElementById("dateall").checked){
			datewhoel=$("#dateall").val();
		}
		if(document.getElementById("specific").checked){
			datewhoel=$("#selectyear").val()+"-"+$("#selectmonth").val();
			month=$("#selectmonth").val();
		}
		if(document.getElementById("datespecific").checked){
			datewhoel="from"+startdate+"to"+enddate;
		}
		isdoing=true;
		$("#status").html("Running...");
		$.ajax({
			type: "POST",
       		url: urlpath,
			data:"protype="+protype+"&datewhoel="+datewhoel+"&startdate="+startdate+"&enddate="+enddate+"&month="+month,
			success: function(msg){
				isdoing=false;
				//alert(msg);
				if(msg!=""){
					window.location.href="__APP__/Yoga/Tongji/openwhole_tongji_en/id/"+msg;
				}
				else{
					window.parent.document.location.reload();window.parent.g_pop.close();
				}
			 }
		});
        //newparent();
       // flag=false;
	}
	function newparent(){
		window.parent.document.location.reload();
	}
	$(document).ready(function(){
		var today=new Date();
		if (typeof(year)  ==  "undefined")
		{
			var year=today.getFullYear();
			$("#year"+year).attr('selected','true');
		}
		if (typeof(month)  ==  "undefined")
		{
			var month = today.getMonth()+1;
			$("#month"+month).attr('selected','true');
		}	
		changeyearmonth();
	});
function changeyearmonth()
{
	document.getElementById("datespecific").checked=true;

	var year=$("#selectyear").val();
	var month=$("#selectmonth").val();
	if (month=="")
	{
	$("#startdate").val(year+"01-01");
	$("#enddate").val(year+"12-31");
	}
	else
	{
	$("#startdate").val(year+"-"+month+"-01");
	$("#enddate").val(year+"-"+month+"-31");
	}
	if (year=="")
	{
		$("#selectmonth").val("");
		$("#selectmonth").hide();
		$("#dateall").attr("selected","true");
	}
	else
		$("#selectmonth").show();
	
}	
</script>
